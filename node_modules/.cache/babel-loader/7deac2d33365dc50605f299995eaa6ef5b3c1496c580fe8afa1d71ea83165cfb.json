{"ast":null,"code":"\"use strict\";\n\nfunction _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.cancelMFALogin = cancelMFALogin;\nexports.cancelResetPassword = cancelResetPassword;\nexports.logIn = logIn;\nexports.resetPassword = resetPassword;\nexports.resetPasswordSuccess = resetPasswordSuccess;\nexports.showLoginActivity = showLoginActivity;\nexports.showLoginMFAActivity = showLoginMFAActivity;\nexports.showResetPasswordActivity = showResetPasswordActivity;\nexports.showSignUpActivity = showSignUpActivity;\nexports.signUp = signUp;\nexports.signUpError = signUpError;\nexports.toggleTermsAcceptance = toggleTermsAcceptance;\nvar _index = require(\"../../store/index\");\nvar _web_api = _interopRequireDefault(require(\"../../core/web_api\"));\nvar _actions = require(\"../../core/actions\");\nvar l = _interopRequireWildcard(require(\"../../core/index\"));\nvar c = _interopRequireWildcard(require(\"../../field/index\"));\nvar _dompurify = require(\"dompurify\");\nvar _index4 = require(\"./index\");\nvar i18n = _interopRequireWildcard(require(\"../../i18n\"));\nvar _captcha = require(\"../captcha\");\nfunction _getRequireWildcardCache(e) {\n  if (\"function\" != typeof WeakMap) return null;\n  var r = new WeakMap(),\n    t = new WeakMap();\n  return (_getRequireWildcardCache = function _getRequireWildcardCache(e) {\n    return e ? t : r;\n  })(e);\n}\nfunction _interopRequireWildcard(e, r) {\n  if (!r && e && e.__esModule) return e;\n  if (null === e || \"object\" != _typeof(e) && \"function\" != typeof e) return {\n    default: e\n  };\n  var t = _getRequireWildcardCache(r);\n  if (t && t.has(e)) return t.get(e);\n  var n = {\n      __proto__: null\n    },\n    a = Object.defineProperty && Object.getOwnPropertyDescriptor;\n  for (var u in e) if (\"default\" !== u && {}.hasOwnProperty.call(e, u)) {\n    var i = a ? Object.getOwnPropertyDescriptor(e, u) : null;\n    i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u];\n  }\n  return n.default = e, t && t.set(e, n), n;\n}\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction logIn(id) {\n  var needsMFA = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var usernameField = (0, _index4.databaseLogInWithEmail)(m) ? 'email' : 'username';\n  var username = c.getFieldValue(m, usernameField);\n  var params = {\n    connection: (0, _index4.databaseConnectionName)(m),\n    username: username,\n    password: c.getFieldValue(m, 'password')\n  };\n  var fields = [usernameField, 'password'];\n  var isCaptchaValid = (0, _captcha.setCaptchaParams)(m, params, _captcha.Flow.DEFAULT, fields);\n  if (!isCaptchaValid) {\n    return (0, _captcha.showMissingCaptcha)(m, id);\n  }\n  var mfaCode = c.getFieldValue(m, 'mfa_code');\n  if (needsMFA) {\n    params['mfa_code'] = mfaCode;\n    fields.push('mfa_code');\n  }\n  (0, _actions.logIn)(id, fields, params, function (id, error, fields, next) {\n    if (error.error === 'a0.mfa_required') {\n      return showLoginMFAActivity(id);\n    }\n    if (error) {\n      var wasInvalid = error && error.code === 'invalid_captcha';\n      return (0, _captcha.swapCaptcha)(id, _captcha.Flow.DEFAULT, wasInvalid, next);\n    }\n    next();\n  });\n}\nfunction generateRandomUsername(length) {\n  var result = '';\n  var characters = 'abcdefghijklmnopqrstuvwxyz0123456789';\n  var charactersLength = characters.length;\n  for (var i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n}\nfunction signUp(id) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var fields = ['email', 'password'];\n\n  // Skip the username validation if signUpHideUsernameField option is enabled.\n  // We will generate a random username to avoid name collusion before we make the signup API call.\n  if ((0, _index4.databaseConnectionRequiresUsername)(m) && !(0, _index4.signUpHideUsernameField)(m)) fields.push('username');\n  (0, _index4.additionalSignUpFields)(m).forEach(function (x) {\n    return fields.push(x.get('name'));\n  });\n  (0, _actions.validateAndSubmit)(id, fields, function (m) {\n    var params = {\n      connection: (0, _index4.databaseConnectionName)(m),\n      email: c.getFieldValue(m, 'email'),\n      password: c.getFieldValue(m, 'password'),\n      autoLogin: (0, _index4.shouldAutoLogin)(m)\n    };\n    var isCaptchaValid = (0, _captcha.setCaptchaParams)(m, params, _captcha.Flow.DEFAULT, fields);\n    if (!isCaptchaValid) {\n      return (0, _captcha.showMissingCaptcha)(m, id);\n    }\n    if ((0, _index4.databaseConnectionRequiresUsername)(m)) {\n      if ((0, _index4.signUpHideUsernameField)(m)) {\n        var usernameValidation = (0, _index4.databaseConnection)(m).getIn(['validation', 'username']);\n        var range = usernameValidation ? usernameValidation.toJS() : {\n          max: 15\n        };\n        params.username = generateRandomUsername(range.max);\n      } else {\n        params.username = c.getFieldValue(m, 'username');\n      }\n    }\n    if (!(0, _index4.additionalSignUpFields)(m).isEmpty()) {\n      params.user_metadata = {};\n      (0, _index4.additionalSignUpFields)(m).forEach(function (x) {\n        var storage = x.get('storage');\n        var fieldName = x.get('name');\n        var fieldValue = (0, _dompurify.sanitize)(c.getFieldValue(m, x.get('name')), {\n          ALLOWED_TAGS: []\n        });\n        switch (storage) {\n          case 'root':\n            params[fieldName] = fieldValue;\n            break;\n          default:\n            if (!params.user_metadata) {\n              params.user_metadata = {};\n            }\n            params.user_metadata[fieldName] = fieldValue;\n            break;\n        }\n      });\n    }\n    var errorHandler = function errorHandler(error, popupHandler) {\n      if (!!popupHandler) {\n        popupHandler._current_popup.kill();\n      }\n      var wasInvalidCaptcha = error && error.code === 'invalid_captcha';\n      (0, _captcha.swapCaptcha)(id, _captcha.Flow.DEFAULT, wasInvalidCaptcha, function () {\n        setTimeout(function () {\n          return signUpError(id, error);\n        }, 250);\n      });\n    };\n    try {\n      // For now, always pass 'null' for the context as we don't need it yet.\n      // If we need it later, it'll save a breaking change in hooks already in use.\n      var context = null;\n      l.runHook(m, 'signingUp', context, function () {\n        _web_api.default.signUp(id, params, function (error, result, popupHandler) {\n          if (error) {\n            errorHandler(error, popupHandler);\n          } else {\n            for (var _len = arguments.length, args = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n              args[_key - 3] = arguments[_key];\n            }\n            signUpSuccess.apply(void 0, [id, result, popupHandler].concat(args));\n          }\n        });\n      });\n    } catch (e) {\n      errorHandler(e);\n    }\n  });\n}\nfunction signUpSuccess(id, result, popupHandler) {\n  var lock = (0, _index.read)(_index.getEntity, 'lock', id);\n  l.emitEvent(lock, 'signup success', result);\n  if ((0, _index4.shouldAutoLogin)(lock)) {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n      return m.set('signedUp', true);\n    });\n\n    // TODO: check options, redirect is missing\n    var options = {\n      connection: (0, _index4.databaseConnectionName)(lock),\n      username: c.email(lock),\n      password: c.password(lock)\n    };\n    if (!!popupHandler) {\n      options.popupHandler = popupHandler;\n    }\n    return _web_api.default.logIn(id, options, l.auth.params(lock).toJS(), function (error) {\n      if (error) {\n        setTimeout(function () {\n          return autoLogInError(id, error);\n        }, 250);\n      } else {\n        for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n          args[_key2 - 1] = arguments[_key2];\n        }\n        _actions.logInSuccess.apply(void 0, [id].concat(args));\n      }\n    });\n  }\n  var autoclose = l.ui.autoclose(lock);\n  if (!autoclose) {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, function (lock) {\n      return l.setSubmitting(lock, false).set('signedUp', true);\n    });\n  } else {\n    (0, _actions.closeLock)(id, false);\n  }\n}\nfunction signUpError(id, error) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var invalidPasswordKeys = {\n    PasswordDictionaryError: 'password_dictionary_error',\n    PasswordNoUserInfoError: 'password_no_user_info_error',\n    PasswordStrengthError: 'password_strength_error'\n  };\n  l.emitEvent(m, 'signup error', error);\n  var errorKey = error.code === 'invalid_password' && invalidPasswordKeys[error.name] || error.code;\n  var errorMessage = i18n.html(m, ['error', 'signUp', errorKey]) || i18n.html(m, ['error', 'signUp', 'lock.fallback']);\n  if (error.code === 'hook_error') {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false, error.description || errorMessage);\n    return;\n  }\n  if (errorKey === 'invalid_captcha') {\n    errorMessage = i18n.html(m, ['error', 'login', errorKey]);\n    return (0, _captcha.swapCaptcha)(id, _captcha.Flow.DEFAULT, true, function () {\n      (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false, errorMessage);\n    });\n  }\n  (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false, errorMessage);\n}\nfunction autoLogInError(id, error) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n    var errorMessage = l.loginErrorMessage(m, error);\n    if ((0, _index4.hasScreen)(m, 'login')) {\n      return l.setSubmitting((0, _index4.setScreen)(m, 'login'), false, errorMessage);\n    } else {\n      return l.setSubmitting(m, false, errorMessage);\n    }\n  });\n}\nfunction resetPassword(id) {\n  (0, _actions.validateAndSubmit)(id, ['email'], function (m) {\n    var params = {\n      connection: (0, _index4.databaseConnectionName)(m),\n      email: c.getFieldValue(m, 'email')\n    };\n    var isCaptchaValid = (0, _captcha.setCaptchaParams)(m, params, _captcha.Flow.PASSWORD_RESET, ['email']);\n    if (!isCaptchaValid) {\n      return (0, _captcha.showMissingCaptcha)(m, id, _captcha.Flow.PASSWORD_RESET);\n    }\n    _web_api.default.resetPassword(id, params, function (error) {\n      if (error) {\n        setTimeout(function () {\n          return resetPasswordError(id, error);\n        }, 250);\n      } else {\n        resetPasswordSuccess(id);\n      }\n    });\n  });\n}\nfunction resetPasswordSuccess(id) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  if ((0, _index4.hasScreen)(m, 'login')) {\n    (0, _captcha.swapCaptcha)(id, _captcha.Flow.PASSWORD_RESET, false, function () {\n      (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n        return (0, _index4.setScreen)(l.setSubmitting(m, false), 'login', ['']);\n      } // array with one empty string tells the function to not clear any field\n      );\n    });\n\n    // TODO: should be handled by box\n    setTimeout(function () {\n      var successMessage = i18n.html(m, ['success', 'forgotPassword']);\n      (0, _index.swap)(_index.updateEntity, 'lock', id, l.setGlobalSuccess, successMessage);\n    }, 500);\n  } else {\n    if (l.ui.autoclose(m)) {\n      (0, _actions.closeLock)(id);\n    } else {\n      (0, _captcha.swapCaptcha)(id, _captcha.Flow.PASSWORD_RESET, false, function () {\n        (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n          return l.setSubmitting(m, false).set('passwordResetted', true);\n        });\n      });\n    }\n  }\n}\nfunction resetPasswordError(id, error) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var key = error.code;\n  if (error.code === 'invalid_captcha') {\n    var captchaConfig = l.passwordResetCaptcha(m);\n    key = captchaConfig.get('provider') === 'recaptcha_v2' || captchaConfig.get('provider') === 'recaptcha_enterprise' ? 'invalid_recaptcha' : 'invalid_captcha';\n  }\n  var errorMessage = i18n.html(m, ['error', 'forgotPassword', key]) || i18n.html(m, ['error', 'forgotPassword', 'lock.fallback']);\n  (0, _captcha.swapCaptcha)(id, _captcha.Flow.PASSWORD_RESET, error.code === 'invalid_captcha', function () {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false, errorMessage);\n  });\n}\nfunction showLoginActivity(id) {\n  var fields = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ['password'];\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var captchaConfig = l.captcha(m);\n  if (captchaConfig && captchaConfig.get('provider') === 'arkose') {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setScreen, 'login', fields);\n  } else {\n    (0, _captcha.swapCaptcha)(id, 'login', false, function () {\n      (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setScreen, 'login', fields);\n    });\n  }\n}\nfunction showSignUpActivity(id) {\n  var fields = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ['password'];\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var captchaConfig = l.captcha(m);\n  if (captchaConfig && captchaConfig.get('provider') === 'arkose') {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setScreen, 'signUp', fields);\n  } else {\n    (0, _captcha.swapCaptcha)(id, 'login', false, function () {\n      (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setScreen, 'signUp', fields);\n    });\n  }\n}\nfunction showResetPasswordActivity(id) {\n  var fields = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ['password'];\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var captchaConfig = l.passwordResetCaptcha(m);\n  if (captchaConfig && captchaConfig.get('provider') === 'arkose') {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setScreen, 'forgotPassword', fields);\n  } else {\n    (0, _captcha.swapCaptcha)(id, 'login', false, function () {\n      (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setScreen, 'forgotPassword', fields);\n    });\n  }\n}\nfunction cancelResetPassword(id) {\n  return showLoginActivity(id);\n}\nfunction cancelMFALogin(id) {\n  return showLoginActivity(id);\n}\nfunction toggleTermsAcceptance(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.toggleTermsAcceptance);\n}\nfunction showLoginMFAActivity(id) {\n  var fields = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ['mfa_code'];\n  (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setScreen, 'mfaLogin', fields);\n}","map":{"version":3,"names":["_typeof","o","Symbol","iterator","constructor","prototype","Object","defineProperty","exports","value","cancelMFALogin","cancelResetPassword","logIn","resetPassword","resetPasswordSuccess","showLoginActivity","showLoginMFAActivity","showResetPasswordActivity","showSignUpActivity","signUp","signUpError","toggleTermsAcceptance","_index","require","_web_api","_interopRequireDefault","_actions","l","_interopRequireWildcard","c","_dompurify","_index4","i18n","_captcha","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","obj","id","needsMFA","arguments","length","undefined","m","read","getEntity","usernameField","databaseLogInWithEmail","username","getFieldValue","params","connection","databaseConnectionName","password","fields","isCaptchaValid","setCaptchaParams","Flow","DEFAULT","showMissingCaptcha","mfaCode","push","error","next","wasInvalid","code","swapCaptcha","generateRandomUsername","result","characters","charactersLength","charAt","Math","floor","random","databaseConnectionRequiresUsername","signUpHideUsernameField","additionalSignUpFields","forEach","x","validateAndSubmit","email","autoLogin","shouldAutoLogin","usernameValidation","databaseConnection","getIn","range","toJS","max","isEmpty","user_metadata","storage","fieldName","fieldValue","sanitize","ALLOWED_TAGS","errorHandler","popupHandler","_current_popup","kill","wasInvalidCaptcha","setTimeout","context","runHook","_len","args","Array","_key","signUpSuccess","apply","concat","lock","emitEvent","swap","updateEntity","options","auth","autoLogInError","_len2","_key2","logInSuccess","autoclose","ui","setSubmitting","closeLock","invalidPasswordKeys","PasswordDictionaryError","PasswordNoUserInfoError","PasswordStrengthError","errorKey","name","errorMessage","html","description","loginErrorMessage","hasScreen","setScreen","PASSWORD_RESET","resetPasswordError","successMessage","setGlobalSuccess","key","captchaConfig","passwordResetCaptcha","captcha"],"sources":["/Users/sunguannan/VisualStudioProjects/authdemo/node_modules/auth0-lock/lib/connection/database/actions.js"],"sourcesContent":["\"use strict\";\n\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.cancelMFALogin = cancelMFALogin;\nexports.cancelResetPassword = cancelResetPassword;\nexports.logIn = logIn;\nexports.resetPassword = resetPassword;\nexports.resetPasswordSuccess = resetPasswordSuccess;\nexports.showLoginActivity = showLoginActivity;\nexports.showLoginMFAActivity = showLoginMFAActivity;\nexports.showResetPasswordActivity = showResetPasswordActivity;\nexports.showSignUpActivity = showSignUpActivity;\nexports.signUp = signUp;\nexports.signUpError = signUpError;\nexports.toggleTermsAcceptance = toggleTermsAcceptance;\nvar _index = require(\"../../store/index\");\nvar _web_api = _interopRequireDefault(require(\"../../core/web_api\"));\nvar _actions = require(\"../../core/actions\");\nvar l = _interopRequireWildcard(require(\"../../core/index\"));\nvar c = _interopRequireWildcard(require(\"../../field/index\"));\nvar _dompurify = require(\"dompurify\");\nvar _index4 = require(\"./index\");\nvar i18n = _interopRequireWildcard(require(\"../../i18n\"));\nvar _captcha = require(\"../captcha\");\nfunction _getRequireWildcardCache(e) { if (\"function\" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(e) { return e ? t : r; })(e); }\nfunction _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || \"object\" != _typeof(e) && \"function\" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if (\"default\" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\nfunction logIn(id) {\n  var needsMFA = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var usernameField = (0, _index4.databaseLogInWithEmail)(m) ? 'email' : 'username';\n  var username = c.getFieldValue(m, usernameField);\n  var params = {\n    connection: (0, _index4.databaseConnectionName)(m),\n    username: username,\n    password: c.getFieldValue(m, 'password')\n  };\n  var fields = [usernameField, 'password'];\n  var isCaptchaValid = (0, _captcha.setCaptchaParams)(m, params, _captcha.Flow.DEFAULT, fields);\n  if (!isCaptchaValid) {\n    return (0, _captcha.showMissingCaptcha)(m, id);\n  }\n  var mfaCode = c.getFieldValue(m, 'mfa_code');\n  if (needsMFA) {\n    params['mfa_code'] = mfaCode;\n    fields.push('mfa_code');\n  }\n  (0, _actions.logIn)(id, fields, params, function (id, error, fields, next) {\n    if (error.error === 'a0.mfa_required') {\n      return showLoginMFAActivity(id);\n    }\n    if (error) {\n      var wasInvalid = error && error.code === 'invalid_captcha';\n      return (0, _captcha.swapCaptcha)(id, _captcha.Flow.DEFAULT, wasInvalid, next);\n    }\n    next();\n  });\n}\nfunction generateRandomUsername(length) {\n  var result = '';\n  var characters = 'abcdefghijklmnopqrstuvwxyz0123456789';\n  var charactersLength = characters.length;\n  for (var i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n}\nfunction signUp(id) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var fields = ['email', 'password'];\n\n  // Skip the username validation if signUpHideUsernameField option is enabled.\n  // We will generate a random username to avoid name collusion before we make the signup API call.\n  if ((0, _index4.databaseConnectionRequiresUsername)(m) && !(0, _index4.signUpHideUsernameField)(m)) fields.push('username');\n  (0, _index4.additionalSignUpFields)(m).forEach(function (x) {\n    return fields.push(x.get('name'));\n  });\n  (0, _actions.validateAndSubmit)(id, fields, function (m) {\n    var params = {\n      connection: (0, _index4.databaseConnectionName)(m),\n      email: c.getFieldValue(m, 'email'),\n      password: c.getFieldValue(m, 'password'),\n      autoLogin: (0, _index4.shouldAutoLogin)(m)\n    };\n    var isCaptchaValid = (0, _captcha.setCaptchaParams)(m, params, _captcha.Flow.DEFAULT, fields);\n    if (!isCaptchaValid) {\n      return (0, _captcha.showMissingCaptcha)(m, id);\n    }\n    if ((0, _index4.databaseConnectionRequiresUsername)(m)) {\n      if ((0, _index4.signUpHideUsernameField)(m)) {\n        var usernameValidation = (0, _index4.databaseConnection)(m).getIn(['validation', 'username']);\n        var range = usernameValidation ? usernameValidation.toJS() : {\n          max: 15\n        };\n        params.username = generateRandomUsername(range.max);\n      } else {\n        params.username = c.getFieldValue(m, 'username');\n      }\n    }\n    if (!(0, _index4.additionalSignUpFields)(m).isEmpty()) {\n      params.user_metadata = {};\n      (0, _index4.additionalSignUpFields)(m).forEach(function (x) {\n        var storage = x.get('storage');\n        var fieldName = x.get('name');\n        var fieldValue = (0, _dompurify.sanitize)(c.getFieldValue(m, x.get('name')), {\n          ALLOWED_TAGS: []\n        });\n        switch (storage) {\n          case 'root':\n            params[fieldName] = fieldValue;\n            break;\n          default:\n            if (!params.user_metadata) {\n              params.user_metadata = {};\n            }\n            params.user_metadata[fieldName] = fieldValue;\n            break;\n        }\n      });\n    }\n    var errorHandler = function errorHandler(error, popupHandler) {\n      if (!!popupHandler) {\n        popupHandler._current_popup.kill();\n      }\n      var wasInvalidCaptcha = error && error.code === 'invalid_captcha';\n      (0, _captcha.swapCaptcha)(id, _captcha.Flow.DEFAULT, wasInvalidCaptcha, function () {\n        setTimeout(function () {\n          return signUpError(id, error);\n        }, 250);\n      });\n    };\n    try {\n      // For now, always pass 'null' for the context as we don't need it yet.\n      // If we need it later, it'll save a breaking change in hooks already in use.\n      var context = null;\n      l.runHook(m, 'signingUp', context, function () {\n        _web_api.default.signUp(id, params, function (error, result, popupHandler) {\n          if (error) {\n            errorHandler(error, popupHandler);\n          } else {\n            for (var _len = arguments.length, args = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n              args[_key - 3] = arguments[_key];\n            }\n            signUpSuccess.apply(void 0, [id, result, popupHandler].concat(args));\n          }\n        });\n      });\n    } catch (e) {\n      errorHandler(e);\n    }\n  });\n}\nfunction signUpSuccess(id, result, popupHandler) {\n  var lock = (0, _index.read)(_index.getEntity, 'lock', id);\n  l.emitEvent(lock, 'signup success', result);\n  if ((0, _index4.shouldAutoLogin)(lock)) {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n      return m.set('signedUp', true);\n    });\n\n    // TODO: check options, redirect is missing\n    var options = {\n      connection: (0, _index4.databaseConnectionName)(lock),\n      username: c.email(lock),\n      password: c.password(lock)\n    };\n    if (!!popupHandler) {\n      options.popupHandler = popupHandler;\n    }\n    return _web_api.default.logIn(id, options, l.auth.params(lock).toJS(), function (error) {\n      if (error) {\n        setTimeout(function () {\n          return autoLogInError(id, error);\n        }, 250);\n      } else {\n        for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n          args[_key2 - 1] = arguments[_key2];\n        }\n        _actions.logInSuccess.apply(void 0, [id].concat(args));\n      }\n    });\n  }\n  var autoclose = l.ui.autoclose(lock);\n  if (!autoclose) {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, function (lock) {\n      return l.setSubmitting(lock, false).set('signedUp', true);\n    });\n  } else {\n    (0, _actions.closeLock)(id, false);\n  }\n}\nfunction signUpError(id, error) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var invalidPasswordKeys = {\n    PasswordDictionaryError: 'password_dictionary_error',\n    PasswordNoUserInfoError: 'password_no_user_info_error',\n    PasswordStrengthError: 'password_strength_error'\n  };\n  l.emitEvent(m, 'signup error', error);\n  var errorKey = error.code === 'invalid_password' && invalidPasswordKeys[error.name] || error.code;\n  var errorMessage = i18n.html(m, ['error', 'signUp', errorKey]) || i18n.html(m, ['error', 'signUp', 'lock.fallback']);\n  if (error.code === 'hook_error') {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false, error.description || errorMessage);\n    return;\n  }\n  if (errorKey === 'invalid_captcha') {\n    errorMessage = i18n.html(m, ['error', 'login', errorKey]);\n    return (0, _captcha.swapCaptcha)(id, _captcha.Flow.DEFAULT, true, function () {\n      (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false, errorMessage);\n    });\n  }\n  (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false, errorMessage);\n}\nfunction autoLogInError(id, error) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n    var errorMessage = l.loginErrorMessage(m, error);\n    if ((0, _index4.hasScreen)(m, 'login')) {\n      return l.setSubmitting((0, _index4.setScreen)(m, 'login'), false, errorMessage);\n    } else {\n      return l.setSubmitting(m, false, errorMessage);\n    }\n  });\n}\nfunction resetPassword(id) {\n  (0, _actions.validateAndSubmit)(id, ['email'], function (m) {\n    var params = {\n      connection: (0, _index4.databaseConnectionName)(m),\n      email: c.getFieldValue(m, 'email')\n    };\n    var isCaptchaValid = (0, _captcha.setCaptchaParams)(m, params, _captcha.Flow.PASSWORD_RESET, ['email']);\n    if (!isCaptchaValid) {\n      return (0, _captcha.showMissingCaptcha)(m, id, _captcha.Flow.PASSWORD_RESET);\n    }\n    _web_api.default.resetPassword(id, params, function (error) {\n      if (error) {\n        setTimeout(function () {\n          return resetPasswordError(id, error);\n        }, 250);\n      } else {\n        resetPasswordSuccess(id);\n      }\n    });\n  });\n}\nfunction resetPasswordSuccess(id) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  if ((0, _index4.hasScreen)(m, 'login')) {\n    (0, _captcha.swapCaptcha)(id, _captcha.Flow.PASSWORD_RESET, false, function () {\n      (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n        return (0, _index4.setScreen)(l.setSubmitting(m, false), 'login', ['']);\n      } // array with one empty string tells the function to not clear any field\n      );\n    });\n\n    // TODO: should be handled by box\n    setTimeout(function () {\n      var successMessage = i18n.html(m, ['success', 'forgotPassword']);\n      (0, _index.swap)(_index.updateEntity, 'lock', id, l.setGlobalSuccess, successMessage);\n    }, 500);\n  } else {\n    if (l.ui.autoclose(m)) {\n      (0, _actions.closeLock)(id);\n    } else {\n      (0, _captcha.swapCaptcha)(id, _captcha.Flow.PASSWORD_RESET, false, function () {\n        (0, _index.swap)(_index.updateEntity, 'lock', id, function (m) {\n          return l.setSubmitting(m, false).set('passwordResetted', true);\n        });\n      });\n    }\n  }\n}\nfunction resetPasswordError(id, error) {\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var key = error.code;\n  if (error.code === 'invalid_captcha') {\n    var captchaConfig = l.passwordResetCaptcha(m);\n    key = captchaConfig.get('provider') === 'recaptcha_v2' || captchaConfig.get('provider') === 'recaptcha_enterprise' ? 'invalid_recaptcha' : 'invalid_captcha';\n  }\n  var errorMessage = i18n.html(m, ['error', 'forgotPassword', key]) || i18n.html(m, ['error', 'forgotPassword', 'lock.fallback']);\n  (0, _captcha.swapCaptcha)(id, _captcha.Flow.PASSWORD_RESET, error.code === 'invalid_captcha', function () {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, l.setSubmitting, false, errorMessage);\n  });\n}\nfunction showLoginActivity(id) {\n  var fields = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ['password'];\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var captchaConfig = l.captcha(m);\n  if (captchaConfig && captchaConfig.get('provider') === 'arkose') {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setScreen, 'login', fields);\n  } else {\n    (0, _captcha.swapCaptcha)(id, 'login', false, function () {\n      (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setScreen, 'login', fields);\n    });\n  }\n}\nfunction showSignUpActivity(id) {\n  var fields = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ['password'];\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var captchaConfig = l.captcha(m);\n  if (captchaConfig && captchaConfig.get('provider') === 'arkose') {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setScreen, 'signUp', fields);\n  } else {\n    (0, _captcha.swapCaptcha)(id, 'login', false, function () {\n      (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setScreen, 'signUp', fields);\n    });\n  }\n}\nfunction showResetPasswordActivity(id) {\n  var fields = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ['password'];\n  var m = (0, _index.read)(_index.getEntity, 'lock', id);\n  var captchaConfig = l.passwordResetCaptcha(m);\n  if (captchaConfig && captchaConfig.get('provider') === 'arkose') {\n    (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setScreen, 'forgotPassword', fields);\n  } else {\n    (0, _captcha.swapCaptcha)(id, 'login', false, function () {\n      (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setScreen, 'forgotPassword', fields);\n    });\n  }\n}\nfunction cancelResetPassword(id) {\n  return showLoginActivity(id);\n}\nfunction cancelMFALogin(id) {\n  return showLoginActivity(id);\n}\nfunction toggleTermsAcceptance(id) {\n  (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.toggleTermsAcceptance);\n}\nfunction showLoginMFAActivity(id) {\n  var fields = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ['mfa_code'];\n  (0, _index.swap)(_index.updateEntity, 'lock', id, _index4.setScreen, 'mfaLogin', fields);\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}