{"ast":null,"code":"var format = require('./helper').format;\nvar PasswordPolicyError = require('./policy_error');\nfunction isString(value) {\n  return typeof value === 'string' || value instanceof String;\n}\nvar defaultRuleset = {\n  length: require('./rules/length'),\n  contains: require('./rules/contains'),\n  containsAtLeast: require('./rules/containsAtLeast'),\n  identicalChars: require('./rules/identicalChars')\n};\nfunction flatDescriptions(descriptions, index) {\n  if (!descriptions.length) {\n    return '';\n  }\n  function flatSingleDescription(description, index) {\n    var spaces = new Array(index + 1).join(' ');\n    var result = spaces + '* ';\n    if (description.format) {\n      result += format.apply(null, [description.message].concat(description.format));\n    } else {\n      result += description.message;\n    }\n    if (description.items) {\n      result += '\\n' + spaces + flatDescriptions(description.items, index + 1);\n    }\n    return result;\n  }\n  var firstDescription = flatSingleDescription(descriptions[0], index);\n  descriptions = descriptions.slice(1).reduce(function (result, description) {\n    result += '\\n' + flatSingleDescription(description, index);\n    return result;\n  }, firstDescription);\n  return descriptions;\n}\n\n/**\n * Creates a PasswordPolicy which is a set of rules.\n *\n * @class PasswordPolicy\n * @constructor\n */\nfunction PasswordPolicy(rules, ruleset) {\n  this.rules = rules;\n  this.ruleset = ruleset || defaultRuleset;\n  this._reduce(function (result, ruleOptions, rule) {\n    rule.validate(ruleOptions);\n  });\n}\nPasswordPolicy.prototype = {};\nPasswordPolicy.prototype._reduce = function (fn, value) {\n  var self = this;\n  return Object.keys(this.rules).reduce(function (result, ruleName) {\n    var ruleOptions = self.rules[ruleName];\n    var rule = self.ruleset[ruleName];\n    return fn(result, ruleOptions, rule);\n  }, value);\n};\nPasswordPolicy.prototype._applyRules = function (password) {\n  return this._reduce(function (result, ruleOptions, rule) {\n    // If previous result was false as this an &&, then nothing to do here!\n    if (!result) {\n      return false;\n    }\n    if (!rule) {\n      return false;\n    }\n    return rule.assert(ruleOptions, password);\n  }, true);\n};\nPasswordPolicy.prototype.missing = function (password) {\n  return this._reduce(function (result, ruleOptions, rule) {\n    var missingRule = rule.missing(ruleOptions, password);\n    result.rules.push(missingRule);\n    result.verified = result.verified && !!missingRule.verified;\n    return result;\n  }, {\n    rules: [],\n    verified: true\n  });\n};\nPasswordPolicy.prototype.explain = function () {\n  return this._reduce(function (result, ruleOptions, rule) {\n    result.push(rule.explain(ruleOptions));\n    return result;\n  }, []);\n};\nPasswordPolicy.prototype.missingAsMarkdown = function (password) {\n  return flatDescriptions(this.missing(password), 1);\n};\nPasswordPolicy.prototype.toString = function () {\n  var descriptions = this.explain();\n  return flatDescriptions(descriptions, 0);\n};\nPasswordPolicy.prototype.check = function (password) {\n  if (!isString(password)) {\n    return false;\n  }\n  return this._applyRules(password);\n};\nPasswordPolicy.prototype.assert = function (password) {\n  if (!this.check(password)) {\n    throw new PasswordPolicyError('Password does not meet password policy');\n  }\n};\nmodule.exports = PasswordPolicy;","map":{"version":3,"names":["format","require","PasswordPolicyError","isString","value","String","defaultRuleset","length","contains","containsAtLeast","identicalChars","flatDescriptions","descriptions","index","flatSingleDescription","description","spaces","Array","join","result","apply","message","concat","items","firstDescription","slice","reduce","PasswordPolicy","rules","ruleset","_reduce","ruleOptions","rule","validate","prototype","fn","self","Object","keys","ruleName","_applyRules","password","assert","missing","missingRule","push","verified","explain","missingAsMarkdown","toString","check","module","exports"],"sources":["/Users/sunguannan/VisualStudioProjects/authdemo/node_modules/password-sheriff/lib/policy.js"],"sourcesContent":["var format = require('./helper').format;\n\nvar PasswordPolicyError = require('./policy_error');\n\nfunction isString(value) {\n  return typeof value === 'string' || value instanceof String;\n}\n\nvar defaultRuleset = {\n  length:           require('./rules/length'),\n  contains:         require('./rules/contains'),\n  containsAtLeast:  require('./rules/containsAtLeast'),\n  identicalChars:   require('./rules/identicalChars'),\n};\n\nfunction flatDescriptions (descriptions, index) {\n  if (!descriptions.length) {\n    return '';\n  }\n\n  function flatSingleDescription (description, index) {\n    var spaces = (new Array(index+1)).join(' ');\n    var result = spaces + '* ';\n    if (description.format) {\n      result += format.apply(null, [description.message].concat(description.format));\n    } else {\n      result += description.message;\n    }\n\n    if (description.items) {\n      result += '\\n' + spaces + flatDescriptions(description.items, index + 1);\n    }\n    return result;\n  }\n\n  var firstDescription = flatSingleDescription(descriptions[0], index);\n\n  descriptions = descriptions.slice(1).reduce(function (result, description) {\n    result += '\\n' + flatSingleDescription(description, index);\n\n    return result;\n  }, firstDescription);\n\n  return descriptions;\n}\n\n/**\n * Creates a PasswordPolicy which is a set of rules.\n *\n * @class PasswordPolicy\n * @constructor\n */\nfunction PasswordPolicy(rules, ruleset) {\n  this.rules = rules;\n  this.ruleset = ruleset || defaultRuleset;\n\n  this._reduce(function (result, ruleOptions, rule) {\n    rule.validate(ruleOptions);\n  });\n}\n\nPasswordPolicy.prototype = {};\n\nPasswordPolicy.prototype._reduce = function (fn, value) {\n  var self = this;\n  return Object.keys(this.rules).reduce(function (result, ruleName) {\n    var ruleOptions = self.rules[ruleName];\n    var rule = self.ruleset[ruleName];\n\n    return fn(result, ruleOptions, rule);\n\n  }, value);\n};\n\nPasswordPolicy.prototype._applyRules = function (password) {\n  return this._reduce(function (result, ruleOptions, rule) {\n    // If previous result was false as this an &&, then nothing to do here!\n    if (!result) {\n      return false;\n    }\n\n    if (!rule) {\n      return false;\n    }\n\n    return rule.assert(ruleOptions, password);\n  }, true);\n};\n\nPasswordPolicy.prototype.missing = function (password) {\n  return this._reduce(function (result, ruleOptions, rule) {\n    var missingRule = rule.missing(ruleOptions, password);\n    result.rules.push(missingRule);\n    result.verified = result.verified && !!missingRule.verified;\n    return result;\n  }, {rules: [], verified: true});\n};\n\nPasswordPolicy.prototype.explain = function () {\n  return this._reduce(function (result, ruleOptions, rule) {\n    result.push(rule.explain(ruleOptions));\n    return result;\n  }, []);\n};\n\nPasswordPolicy.prototype.missingAsMarkdown = function (password) {\n  return flatDescriptions(this.missing(password), 1);\n};\n\nPasswordPolicy.prototype.toString = function () {\n  var descriptions = this.explain();\n  return flatDescriptions(descriptions, 0);\n};\n\nPasswordPolicy.prototype.check = function (password) {\n  if (!isString(password)) {\n    return false;\n  }\n\n  return this._applyRules(password);\n};\n\nPasswordPolicy.prototype.assert = function (password) {\n  if (!this.check(password)) {\n    throw new PasswordPolicyError('Password does not meet password policy');\n  }\n};\n\nmodule.exports = PasswordPolicy;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}